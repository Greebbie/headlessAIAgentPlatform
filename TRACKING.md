# HlAB - Headless Agent Builder 项目跟踪

## 当前状态
- **阶段**: 初始搭建
- **日期**: 2026-02-11
- **分支**: claude/ai-agent-chatbot-framework-If1bt

---

## Session 记录

### Session 1 (2026-02-11) - 项目初始化与框架搭建
**目标**: 从零搭建完整的 Headless AI Agent Chatbot 框架骨架

**完成事项**:
- [x] 项目结构设计与初始化
- [x] 核心 Agent Runtime 引擎
- [x] 工作流/流程编排引擎
- [x] 知识检索系统 (RAG + 快答通道)
- [x] Tool Gateway (工具网关)
- [x] Headless API 层
- [x] 合规审计链路
- [x] Web 可视化控制台骨架

**思路与决策**:
1. 技术栈选择: Python (FastAPI) 后端 + React/TypeScript 前端控制台
   - FastAPI: 异步高性能, 原生 OpenAPI 文档, 适合 AI 场景
   - 国产模型兼容: 通过统一 LLM Adapter 适配 (通义千问/文心/GLM/DeepSeek等)
   - 向量库: 支持 Milvus/Chroma/FAISS, 默认 FAISS 开箱即用
2. 架构分层: API Gateway → Agent Runtime → (Workflow + Knowledge + Tools) → LLM/外部系统
3. 流程引擎设计: JSON/YAML 声明式流程定义, 支持可视化编排
4. 知识系统: 双通道 (快答KV + 标准RAG), 无引用时强制兜底

**未完成/后续改进**:
- [ ] 接入真实 LLM (当前为 mock/adapter 接口)
- [ ] 向量索引的增量更新实现
- [ ] 流程编排可视化拖拽 UI
- [ ] 多租户隔离完善
- [ ] Kubernetes 部署配置
- [ ] 性能压测与优化
- [ ] 国产化操作系统/数据库适配
- [ ] 完整的单元测试与集成测试

---

## 架构概览

```
┌─────────────────────────────────────────────────────┐
│                  客户业务系统                          │
│            (微信小程序/Web/App/企微)                   │
└──────────────────────┬──────────────────────────────┘
                       │ HTTP/WebSocket
                       ▼
┌─────────────────────────────────────────────────────┐
│              Headless API Gateway                     │
│         /invoke  /stream  /webhook                   │
│         认证 · 限流 · 路由 · trace_id                 │
└──────────────────────┬──────────────────────────────┘
                       │
                       ▼
┌─────────────────────────────────────────────────────┐
│               Agent Runtime 引擎                      │
│   ┌──────────┐ ┌──────────┐ ┌──────────────────┐    │
│   │ 对话管理  │ │ 意图识别  │ │ 上下文/记忆管理   │    │
│   └──────────┘ └──────────┘ └──────────────────┘    │
│   ┌──────────┐ ┌──────────┐ ┌──────────────────┐    │
│   │ 回复生成  │ │ 风控拦截  │ │ 人机协同调度      │    │
│   └──────────┘ └──────────┘ └──────────────────┘    │
└─────┬──────────────┬───────────────┬────────────────┘
      │              │               │
      ▼              ▼               ▼
┌──────────┐  ┌──────────────┐ ┌──────────────┐
│ 流程引擎  │  │ 知识检索系统  │ │  Tool Gateway │
│ Workflow  │  │ Knowledge    │ │  工具网关      │
│ Engine    │  │ Retrieval    │ │              │
├──────────┤  ├──────────────┤ ├──────────────┤
│步骤编排   │  │快答KV通道    │ │Schema定义    │
│字段校验   │  │标准RAG通道   │ │权限/审计     │
│表单生成   │  │混合检索      │ │超时/重试     │
│兜底转人工 │  │引用追溯      │ │同步/异步     │
└──────────┘  └──────────────┘ └──────────────┘
      │              │               │
      ▼              ▼               ▼
┌─────────────────────────────────────────────────────┐
│                   基础设施层                           │
│  LLM Adapter │ 向量DB │ 关系DB │ 缓存 │ 消息队列     │
│  (国产模型优先)│ Milvus │ PgSQL  │Redis │ RabbitMQ    │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│              全链路审计 (Audit/Trace)                  │
│   trace_id · 输入 · 检索命中 · 模型输出 · 工具调用    │
│   流程流转 · 转人工原因 · 时延指标                     │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│             Web 可视化控制台 (Console)                 │
│   Agent管理 · 流程编排 · 知识管理 · 工具管理          │
│   审计回放 · 指标面板 · 检索测试                      │
└─────────────────────────────────────────────────────┘
```

---

## 风险与注意事项
1. **模型依赖**: 框架不绑定特定 LLM, 但需确保 prompt 模板可调
2. **数据安全**: 私有化部署场景下全部数据不出域
3. **性能瓶颈**: RAG 检索延迟需控制在 200ms 以内, 快答通道 50ms 以内
4. **合规**: 全链路可回放, 敏感信息脱敏存储
